<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../layouts/scaffold-layout.html">
<link rel="import" href="../elements/code-block.html">
<link rel="import" href="../elements/code-snippet.html">

<polymer-element name="data-binding-page" attributes="pathArg1 queryParam1">
  <template>
    <scaffold-layout selected="databinding">
      <div class="title">Data Binding Demo</div>

      <h2 id="path-variables-and-query-parameters">Path Variables and Query Parameters <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#path-variables-and-query-parameters">#</a></h2>

      <p>Change values in the address bar and see them change here. Path variables and query parameters are automatically attached to the element's attributes.</p>

<code-block>{{routeArgs}}</code-block>

      <h4 id="url" class="top-spacing">URL <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#url">#</a></h4>

<code-block>{{url}}</code-block>

      <h4 id="route" class="top-spacing">Route <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#route">#</a></h4>

      <p>Path variables are defined on the <code-snippet>app-route</code-snippet>.</p>

<code-block>&lt;app-route path="/demo/:pathArg1" import="pages/demo-page.html"&gt;&lt;/app-route&gt;</code-block>

      <h4 id="page" class="top-spacing">Page <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#page">#</a></h4>

      <p>Path variables and query parameters are defined on the custom element and used in the template.</p>

<code-block>&lt;polymer-element name="demo-page" attributes="pathArg1 queryParam1" noscript&gt;
  &lt;template&gt;
    &lt;p&gt;Demo page using a path variable {{'\{{pathArg1}\}'}} and query parameter {{'\{{queryParam1}\}'}}!&lt;/p&gt;
  &lt;/template&gt;
&lt;/polymer-element&gt;</code-block>

      <h2 id="polymer-template" class="top-spacing">Polymer &lt;template&gt; <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#polymer-template">#</a></h2>

      <p>If you're using Polymer, you can also bind path variables and query parameters to templates.</p>

<code-block>&lt;app-route path="/order/:orderId"&gt;
  &lt;template&gt;
    &lt;p&gt;Your order number is {{'\{{orderId}\}'}}&lt;/p&gt;
  &lt;/template&gt;
&lt;/app-route&gt;</code-block>

      <h2 id="bindrouter-attribute" class="top-spacing">bindRouter attribute <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#bindrouter-attribute">#</a></h2>

      <p>You can bind the router to an element or template using the <code-snippet>bindRouter</code-snippet> attribute. This gives you access to the router's API including <code-snippet>router.go('/path')</code-snippet>.</p>

<code-block>&lt;app-router&gt;
  &lt;app-route path="/customer/:customerId" element="customer-page" bindRouter&gt;&lt;/app-route&gt;
&lt;/app-router&gt;

&lt;!-- the customer-page has attributes for path variables and the router --&gt;
&lt;polymer-element name="customer-page" attributes="customerId router"&gt;
  &lt;template&gt;
    &lt;h2&gt;Customer ID: {{'\{{customerId}\}'}}&lt;/h2&gt;
    &lt;button on-click="{{'\{{viewCustomerOrders}\}'}}"&gt;Orders&lt;/button&gt;
  &lt;/template&gt;
  &lt;script&gt;
    Polymer('customer-page', {
      viewCustomerOrders: function() {
        this.router.go('/orders/' + this.customerId);
      }
    });
  &lt;/script&gt;
&lt;/polymer-element&gt;</code-block>

      <h2 id="before-data-binding-event" class="top-spacing">before-data-binding event <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#before-data-binding-event">#</a></h4>
      <p>The <code-snippet>before-data-binding</code-snippet> event allows you to update the model before it is bound to the route's custom element or template.</p>
<code-block>&lt;app-router&gt;
  &lt;app-route path="/" import="/pages/home-page.html" on-before-data-binding="{{'\{{bindSession}\}'}}"&gt;&lt;/app-route&gt;
&lt;/app-router&gt;</code-block>

<code-block>// event.detail looks like this
{
  path: '/new-path',
  route: newRoute,
  oldRoute: oldRoute,
  model: {
    // path variables and query parameters
    // modify or add properties here before data binding happens
  }
}</code-block>
      <p>See <a is="pushstate-anchor" href="../#/events#before-data-binding">Lifecycle Events before-data-binding</a> for more info.</p>

      <h2 id="callbacks" class="top-spacing">attachedCallback() and domReady() <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#callbacks">#</a></h2>

      <p>Warning: The <code-snippet>createdCallback()</code-snippet> and Polymer's <code-snippet>ready()</code-snippet> callback are called BEFORE data binding.</p>

      <p>Steps to load a new route.</p>

      <ul>
        <li>import element</li>
        <li><code-snippet>el = document.createElement('element-name')</code-snippet></li>
        <li>data binding</li>
        <li><code-snippet>activeRoute.appendChild(el)</code-snippet></li>
      </ul>

      <p>The <code-snippet>attachedCallback()</code-snippet> and Polymer's <code-snippet>domReady()</code-snippet> callback are called after data binding is complete. If you're using <code-snippet>bindRouter</code-snippet>, you should use <code-snippet>attachedCallback()</code-snippet> or <code-snippet>domReady()</code-snippet> to wait for <code-snippet>this.router</code-snippet> to be defined.</p>

      <h2 id="accessing-the-parent-scope" class="top-spacing">Accessing the parent scope <a href="../#/databinding/1337?queryParam1=Routing%20with%20Web%20Components!#accessing-the-parent-scope">#</a></h2>

      <p>If you're using Polymer you can also access the parent scope using <code-snippet>router.templateInstance.model</code-snippet>. See <a href="https://www.polymer-project.org/docs/polymer/databinding.html#event-handling-and-data-binding">Polymer's documentation</a> on <code-snippet>templateInstance.model</code-snippet>. In short, every DOM element in a Polymer template has a <code-snippet>templateInstance</code-snippet> property that references the template (or custom element) that contains it.</p>

<code-block>&lt;template is="auto-binding"&gt;
  &lt;user-session session="{{'\{{session}\}'}}"&gt;&lt;/user-session&gt;

  &lt;app-router&gt;
    &lt;app-route path="/customer/:customerId" bindRouter&gt;
      &lt;template&gt;
        &lt;!-- this template does not have acces to {{'\{{session}\}'}} in the parent scope. it can use {{'\{{router}\}'}} instead. --&gt;
        &lt;h2&gt;Hello {{'\{{router.templateInstance.model.session.userName}\}'}}&lt;/h2&gt;
        &lt;!-- {{'\{{customerId}\}'}} is bound directly to this template --&gt;
        &lt;h2&gt;Customer ID: {{'\{{customerId}\}'}}&lt;/h2&gt;
      &lt;/template&gt;
    &lt;/app-route&gt;
  &lt;/app-router&gt;
&lt;/template&gt;</code-block>

    </scaffold-layout>
  </template>
  <script>
    Polymer({
      attachedCallback: function() {
        this.url = window.location.href;
        this.routeArgs = JSON.stringify({
          "pathArg1": this.pathArg1,
          "queryParam1": this.queryParam1
        }, null, 2);
      }
    });
  </script>
</polymer-element>
